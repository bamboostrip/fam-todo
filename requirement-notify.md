# éœ€æ±‚æ–‡æ¡£ï¼šä»»åŠ¡æé†’ç³»ç»Ÿ (Reminder System)

## 1\. åŠŸèƒ½æ¦‚è¿°

å…è®¸ç”¨æˆ·ä¸ºæ¯ä¸€ä¸ª Todo è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„è§¦å‘æ—¶é—´ã€‚å½“ç³»ç»Ÿæ—¶é—´åˆ°è¾¾è¯¥è®¾å®šç‚¹æ—¶ï¼Œåº”ç”¨éœ€è¦å‘é€**ç³»ç»Ÿçº§é€šçŸ¥**ï¼ˆSystem Notificationï¼‰ï¼Œæé†’ç”¨æˆ·å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿åº”ç”¨å¤„äºåå°æˆ–æœ€å°åŒ–çŠ¶æ€ã€‚

---

## 2\. äº¤äº’ç•Œé¢ (UI/UX)

å‚è€ƒä½ æä¾›çš„æˆªå›¾ï¼Œäº¤äº’åˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š

### A. å¿«æ·é€‰é¡¹èœå• (Quick Options Menu)

ç‚¹å‡»â€œæé†’â€å›¾æ ‡åå¼¹å‡º Popover èœå•ï¼ŒåŒ…å«æ™ºèƒ½è®¡ç®—çš„å»ºè®®æ—¶é—´ï¼š

1.  **â° ä»Šæ—¥æ™šäº›æ—¶å€™ (Later Today):** _åŠ¨æ€æ˜¾ç¤º/éšè—_ (è¯¦è§ä¸šåŠ¡é€»è¾‘)ã€‚
2.  **â¡ï¸ æ˜å¤© (Tomorrow):** æ˜¾ç¤ºâ€œæ˜å¤©, 09:00â€ (æˆ–å…¶ä»–é»˜è®¤æ—¶é—´)ã€‚
3.  **â© ä¸‹å‘¨ (Next Week):** æ˜¾ç¤ºâ€œä¸‹å‘¨ä¸€, 09:00â€ã€‚
4.  **ğŸ“… é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´ (Pick a Date & Time):** æ‰“å¼€è‡ªå®šä¹‰é€‰æ‹©å™¨ã€‚
5.  _(å¯é€‰) âŒ æ¸…é™¤æé†’:_ å¦‚æœå½“å‰å·²æœ‰æé†’ï¼Œæä¾›æ¸…é™¤é€‰é¡¹ã€‚

### B. è‡ªå®šä¹‰æ—¶é—´é€‰æ‹©å™¨ (Custom Picker)

- æä¾›æ—¥å†è§†å›¾é€‰æ‹©æ—¥æœŸã€‚
- æä¾›æ—¶é—´è¾“å…¥æ¡†ï¼ˆ00:00 - 23:59ï¼‰ã€‚
- åº•éƒ¨â€œä¿å­˜â€ä¸â€œå–æ¶ˆâ€æŒ‰é’®ã€‚

---

## 3\. ä¸šåŠ¡é€»è¾‘ (Business Logic)

### A. â€œä»Šæ—¥æ™šäº›æ—¶å€™â€çš„åŠ¨æ€é€»è¾‘ (æ ¸å¿ƒéœ€æ±‚)

æ ¹æ®å½“å‰ç³»ç»Ÿæ—¶é—´ (`CurrentTime`)ï¼ŒåŠ¨æ€å†³å®šè¯¥é€‰é¡¹çš„**æ˜¾ç¤ºæ–‡æœ¬**å’Œ**è®¾å®šæ—¶é—´**ã€‚

_é¢„è®¾èŠ‚ç‚¹ï¼š09:00 (ä¸Šåˆ), 13:00 (ä¸‹åˆ), 17:00 (å‚æ™š)_

| å½“å‰æ—¶é—´èŒƒå›´       | é€‰é¡¹æ˜¾ç¤ºæ–‡æœ¬     | è®¾å®šæ—¶é—´ (Target Time) | é€»è¾‘è¯´æ˜                    |
| :----------------- | :--------------- | :--------------------- | :-------------------------- |
| **00:00 \~ 08:59** | ä»Šæ—¥ä¸Šåˆ (09:00) | **ä»Šå¤© 09:00**         | è¿˜æ²¡åˆ°æ—©ä¸Š9ç‚¹ï¼Œå»ºè®®9ç‚¹ã€‚    |
| **09:00 \~ 12:59** | ä»Šæ—¥ä¸‹åˆ (13:00) | **ä»Šå¤© 13:00**         | è¿‡äº†9ç‚¹ä½†æ²¡åˆ°1ç‚¹ï¼Œå»ºè®®1ç‚¹ã€‚ |
| **13:00 \~ 16:59** | ä»Šæ—¥å‚æ™š (17:00) | **ä»Šå¤© 17:00**         | è¿‡äº†1ç‚¹ä½†æ²¡åˆ°5ç‚¹ï¼Œå»ºè®®5ç‚¹ã€‚ |
| **17:00 \~ 23:59** | _(é€‰é¡¹éšè—)_     | **N/A**                | è¶…è¿‡17ç‚¹ï¼Œè¯¥é€‰é¡¹ä¸å†æ˜¾ç¤ºã€‚  |

### B. å…¶ä»–å¿«æ·é€‰é¡¹é€»è¾‘

- **æ˜å¤©:** `Today + 1 Day`ï¼Œæ—¶é—´è®¾ä¸º `09:00`ã€‚
- **ä¸‹å‘¨:**
  - å¦‚æœä»Šå¤©æ˜¯å‘¨äº”ã€å‘¨å…­ã€å‘¨æ—¥ï¼šè®¾ä¸º `ä¸‹å‘¨ä¸€ 09:00`ã€‚
  - _(å¾®è½¯é€»è¾‘å¾®è°ƒ)_ é€šå¸¸æŒ‡â€œä¸‹ä¸€ä¸ªå‘¨ä¸€â€ã€‚

### C. æé†’è§¦å‘é€»è¾‘

1.  **è§¦å‘æ¡ä»¶:** `CurrentTime >= ReminderTime` ä¸” `IsReminded == false`ã€‚
2.  **è§¦å‘åŠ¨ä½œ:**
    - **å‘é€ç³»ç»Ÿé€šçŸ¥:** æ ‡é¢˜ä¸ºä»»åŠ¡å†…å®¹ï¼Œæ­£æ–‡ä¸ºâ€œåˆ°æ—¶é—´å¤„ç†è¯¥ä»»åŠ¡äº†â€ã€‚
    - **åº”ç”¨å†…çŠ¶æ€:** ä»»åŠ¡æ—è¾¹æ˜¾ç¤ºçº¢è‰²çš„é—¹é’Ÿå›¾æ ‡ï¼ˆæˆ–é«˜äº®ï¼‰ï¼Œè¡¨ç¤ºå·²è¿‡æœŸ/æ­£åœ¨æé†’ã€‚
    - **ç‚¹å‡»é€šçŸ¥:** ç‚¹å‡»ç³»ç»Ÿé€šçŸ¥åº”å”¤èµ·/èšç„¦ App çª—å£ï¼Œå¹¶å®šä½åˆ°è¯¥ä»»åŠ¡ã€‚

---

## 4\. æŠ€æœ¯å®ç°æ–¹æ¡ˆ (Tauri Specific)

### æ­¥éª¤ 1: å®‰è£…æ’ä»¶

ä½ éœ€è¦ä½¿ç”¨ Tauri å®˜æ–¹çš„é€šçŸ¥æ’ä»¶ã€‚

```bash
npm run tauri add notification
# æˆ–è€…
pnpm tauri add notification
```

### æ­¥éª¤ 2: é…ç½®æƒé™

åœ¨ `src-tauri/capabilities/default.json` (æˆ– `tauri.conf.json` å–å†³äºç‰ˆæœ¬) ä¸­å…è®¸é€šçŸ¥æƒé™ï¼š

```json
{
  "permissions": ["notification:default", "notification:allow-notification"]
}
```

### æ­¥éª¤ 3: è°ƒåº¦ç­–ç•¥ (å¦‚ä½•åœ¨ç‰¹å®šæ—¶é—´å“é“ƒï¼Ÿ)

è¿™é‡Œæœ‰ä¸¤ç§å®ç°è·¯å¾„ï¼Œæ¨è **è·¯å¾„ B** ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½† **è·¯å¾„ A** æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚

#### è·¯å¾„ A: å‰ç«¯è½®è¯¢ (ç®€å•ï¼Œé€‚åˆåˆæœŸ)

åœ¨ Vue çš„ Store æˆ– App.vue ä¸­å†™ä¸€ä¸ªå®šæ—¶å™¨ã€‚

1.  åº”ç”¨å¯åŠ¨æ—¶ï¼Œå¯åŠ¨ä¸€ä¸ª `setInterval`ï¼Œæ¯ 30 ç§’æˆ– 1 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æ£€æŸ¥ã€‚
2.  éå† Store é‡Œæ‰€æœ‰æœªå®Œæˆä¸”æœ‰ `reminderTime` çš„ä»»åŠ¡ã€‚
3.  å¦‚æœ `dayjs().isAfter(task.reminderTime)` ä¸”å°šæœªæ ‡è®°ä¸ºå·²æé†’ï¼š
    - è°ƒç”¨ Tauri API å‘é€é€šçŸ¥ã€‚
    - æ›´æ–° Task çŠ¶æ€ã€‚

<!-- end list -->

```typescript
import { sendNotification } from '@tauri-apps/plugin-notification'

// ä¼ªä»£ç ï¼šåœ¨ Pinia Store æˆ– App.vue ä¸­
setInterval(async () => {
  const now = new Date()
  const tasks = todoStore.tasks.filter((t) => t.reminderTime && !t.isCompleted)

  for (const task of tasks) {
    if (new Date(task.reminderTime) <= now) {
      // è§¦å‘é€šçŸ¥
      await sendNotification({
        title: 'ä»»åŠ¡æé†’',
        body: task.content,
        icon: 'application-icon', // å¯é€‰
      })

      // è¿™é‡Œçš„é€»è¾‘çœ‹ä½ éœ€æ±‚ï¼šæ˜¯æ¸…ç©ºæé†’æ—¶é—´ï¼Œè¿˜æ˜¯ä¿ç•™ä½†æ ‡è®°ä¸ºå·²è¯»ï¼Ÿ
      // Microsoft To Do é€šå¸¸æ˜¯ä¿ç•™æ—¶é—´ä½†æ˜¾ç¤ºä¸ºçº¢è‰²è¿‡æœŸ
    }
  }
}, 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
```

#### è·¯å¾„ B: Rust åç«¯è°ƒåº¦ (é«˜çº§ï¼Œæ›´ç¨³å®š)

å¦‚æœç”¨æˆ·å…³é—­äº†å‰ç«¯çª—å£ï¼ˆä½†åœ¨ç³»ç»Ÿæ‰˜ç›˜è¿è¡Œï¼‰ï¼Œå‰ç«¯çš„ `setInterval` å¯èƒ½ä¼šåœæ­¢ã€‚ç”¨ Rust å¯ä»¥åœ¨åå°çº¿ç¨‹ç²¾å‡†å®ˆå€™ã€‚

1.  å‰ç«¯è®¾ç½®æé†’æ—¶ï¼Œè°ƒç”¨ Tauri Command `invoke('schedule_reminder', { id, time })`ã€‚
2.  Rust ç«¯ä½¿ç”¨ `tokio::time` æˆ–è€…ç¬¬ä¸‰æ–¹ crateï¼ˆå¦‚ `cron` æˆ–ç®€å•çš„çº¿ç¨‹ä¼‘çœ ï¼‰æ¥ç­‰å¾…ã€‚
3.  æ—¶é—´åˆ°äº†ï¼ŒRust ç›´æ¥è°ƒç”¨ç³»ç»Ÿé€šçŸ¥ APIã€‚

---

### 5\. æ•°æ®ç»“æ„æ›´æ–°

éœ€è¦åœ¨ `TodoItem` æ¥å£ä¸­å¢åŠ å­—æ®µï¼š

| å±æ€§å           | ç±»å‹            | è¯´æ˜                                      |
| :--------------- | :-------------- | :---------------------------------------- | ----------------------------- |
| **reminderTime** | DateTime/string | null                                      | å…·ä½“çš„æé†’æ—¶é—´ç‚¹ (ISO 8601)ã€‚ |
| **isReminded**   | boolean         | (å¯é€‰) å†…éƒ¨çŠ¶æ€ï¼Œé˜²æ­¢åŒä¸€åˆ†é’Ÿå†…é‡å¤å¼¹çª—ã€‚ |

---

### 6\. å¼€å‘å»ºè®®

1.  **æ—¥æœŸåº“:** å¼ºçƒˆå»ºè®®å‰ç«¯ä½¿ç”¨ `date-fns` æˆ– `dayjs` æ¥å¤„ç†â€œä»Šå¤©æ™šäº›æ—¶å€™â€çš„æ—¶é—´æ¯”è¾ƒé€»è¾‘ï¼Œæ‰‹å†™ Date å¯¹è±¡å¾ˆå®¹æ˜“å‡º Bugã€‚
2.  **Windows æƒé™:** åœ¨ Windows ä¸Šï¼Œé€šçŸ¥é€šå¸¸éœ€è¦åº”ç”¨åœ¨å¼€å§‹èœå•æœ‰å¿«æ·æ–¹å¼ï¼ˆå®‰è£…åŒ…å®‰è£…åä¼šè‡ªåŠ¨å¤„ç†ï¼‰ï¼Œå¼€å‘æ¨¡å¼ä¸‹å¯èƒ½éœ€è¦ä½ åœ¨ç³»ç»Ÿè®¾ç½®é‡Œå…è®¸ä½ çš„å¼€å‘åº”ç”¨å‘é€é€šçŸ¥ã€‚
3.  **å£°éŸ³:** Tauri çš„ Notification æ’ä»¶é€šå¸¸æ”¯æŒé»˜è®¤ç³»ç»Ÿæç¤ºéŸ³ã€‚
