## To-Do 应用需求文

### 1. 数据模型设计 (Data Model)

#### A. 新增对象: `SubTodo` (子任务/步骤)

这是一个轻量级的对象，依附于主任务存在。

| 属性名          | 类型        | 说明           | 默认值 |
| :-------------- | :---------- | :------------- | :----- |
| **id**          | string/UUID | 唯一标识符     | -      |
| **content**     | string      | **子任务内容** | -      |
| **isCompleted** | boolean     | **是否完成**   | false  |

#### B. 核心对象: `TodoItem` (更新)

在原基础上增加了 `steps` 字段。

| 属性名           | 类型          | 说明                                                               | 默认值           |
| :--------------- | :------------ | :----------------------------------------------------------------- | :--------------- |
| **id**           | string/UUID   | 唯一标识符                                                         | -                |
| **content**      | string        | **具体内容** (标题)                                                | -                |
| **isCompleted**  | boolean       | **是否完成**                                                       | false            |
| **isImportant**  | boolean       | **是否重要** (星标)                                                | false            |
| **myDayDate**    | Date/null     | **我的一天**。记录加入当天的日期。逻辑判断 `myDayDate === Today`。 | null             |
| **plannedDate**  | Date/null     | **计划日期** (截止日期)                                            | null             |
| **reminderTime** | DateTime/null | **提醒时间**                                                       | null             |
| **recurrence**   | object/string | **重复规则** (每天/工作日/每周/每月/每年)                          | null             |
| **note**         | string        | **备注**                                                           | ""               |
| **listId**       | string        | **所属列表ID**。关联到系统列表或自定义列表。                       | default_tasks_id |
| **steps**        | `SubTodo[]`   | **[新增] 子任务列表**。存放该任务下的所有步骤。                    | []               |
| **createdAt**    | DateTime      | **创建时间**                                                       | Now              |

#### C. 列表对象: `TodoList`

| 属性名    | 类型        | 说明                                                 |
| :-------- | :---------- | :--------------------------------------------------- |
| **id**    | string/UUID | 唯一标识符                                           |
| **title** | string      | 列表名称                                             |
| **icon**  | string      | 列表图标 (Emoji 或 Icon name)                        |
| **type**  | enum        | 列表类型：`system` (系统默认) 或 `user` (用户自定义) |

---

### 2. 业务逻辑 (Business Logic)

#### A. 上下文创建逻辑 (Context-Aware Creation)

当用户在不同的“板块”（视图）创建 Todo 时，系统自动填充默认属性：

1.  **在“我的一天”视图创建:** `myDayDate` = `Today`, `listId` = `Tasks`
2.  **在“重要”视图创建:** `isImportant` = `true`, `listId` = `Tasks`
3.  **在“计划内”视图创建:** `plannedDate` = `Today` (或选中日期), `listId` = `Tasks`
4.  **在“任务”视图创建:** 普通 Todo，无特殊属性。
5.  **在“自定义列表”视图创建:** `listId` = `Current List ID`

#### B. “我的一天”重置逻辑

- **规则:** 每天凌晨（或应用打开时），检查所有 Todo。
- **逻辑:** 若 `todo.myDayDate !== current_date`，则该任务不再显示在“我的一天”列表中（即使它未完成）。

#### C. 重复任务逻辑 (Recurrence)

- 当带有 `recurrence` 的任务完成时，原任务标记完成，并自动创建新实例，日期按规则顺延。

#### D. 子任务与“提升为任务”逻辑 (新增)

1.  **独立完成状态:**
    - 子任务的完成 (`isCompleted`) 不影响主任务的状态。
    - 主任务完成也不强制修改子任务的状态（保持历史记录）。
2.  **提升为任务 (Promote to Task):**
    - **触发:** 用户在子任务上选择“提升为任务”。
    - **流程:**
      1.  **创建:** 生成一个新的 `TodoItem`，其 `content` 继承自子任务。
      2.  **继承:** 新任务的 `listId` 必须与原父任务保持一致（在同一个列表中）。
      3.  **移除:** 从原父任务的 `steps` 数组中移除该 `SubTodo`。
      4.  **属性:** 新任务不继承父任务的 `steps` 或 `note`，是一个全新的开始。

---

### 3. 功能板块划分 (System Architecture)

#### A. 智能清单 (Smart Lists) - _基于属性过滤_

- **☀️ 我的一天:** `myDayDate == Today` AND `!isCompleted`
- **⭐ 重要:** `isImportant == true`
- **📅 计划内:** `plannedDate != null`
- **✅ 已完成:** 展示历史完成记录

#### B. 物理清单 (Physical Lists) - _基于 listId 归属_

- **🏠 任务:** 默认容器
- **📁 [用户自定义列表]:** 用户创建的容器

---

### 4. 交互需求清单

- **列表管理:** 创建、重命名、删除列表（自定义图标）。
- **任务移动:** 拖拽或菜单操作修改 Todo 的 `listId`。
- **任务列表视图:**
  - 显示任务标题。
  - **[新增]** 如果任务有子任务，显示子任务完成进度（例如图标或 "2/4" 文字）。
- **右侧详情页 (Sidebar) - [更新重点]:**
  - **步骤管理:**
    - 输入框：快速添加新的子任务。
    - 列表展示：显示所有子任务，支持勾选完成/取消完成。
    - 拖拽排序：调整子任务顺序。
    - **操作菜单:** 每个子任务右侧提供菜单，包含 **"提升为任务"** 和 "删除"。
  - **属性编辑:** 添加/移除“我的一天”、标记“重要”、设置截止/重复/提醒、编辑备注。
